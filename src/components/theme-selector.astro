---
import Button from "@/components/ui/button.astro";
import { cn } from "@/lib/utils";
import { Moon, Sun } from "@lucide/astro";

const { class: className } = Astro.props;
---

<Button
  id="theme-toggle"
  variant="ghost"
  size="icon"
  aria-label="Toggle theme"
  class={cn("rounded-full", className)}
>
  <Moon class="size-5 dark:hidden" />
  <Sun class="size-5 hidden dark:block" />
</Button>

<script>
  // Theme toggle functionality
  document.addEventListener("DOMContentLoaded", function () {
    const themeButton = document.querySelector("button#theme-toggle");
    const htmlElement = document.documentElement;

    // Check for saved theme preference or use system preference
    const savedTheme = localStorage.getItem("theme");
    const systemPrefersDark = window.matchMedia(
      "(prefers-color-scheme: dark)",
    ).matches;

    // Set initial theme
    if (savedTheme === "dark" || (!savedTheme && systemPrefersDark)) {
      htmlElement.classList.add("dark");
    } else {
      htmlElement.classList.remove("dark");
    }

    // Toggle theme on button click
    themeButton?.addEventListener("click", function () {
      const isDark = htmlElement.classList.toggle("dark");

      // Save preference to localStorage
      localStorage.setItem("theme", isDark ? "dark" : "light");
    });
  });
</script>
